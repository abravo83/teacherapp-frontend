<section
  class="bg-white py-5 d-flex justify-content-center align-items-center"
  style="min-height: 100vh"
>
  <div class="card container p-5 border-0 shadow-lg bg-light">
    <h3
      class="shadow title w-auto align-self-center text-uppercase text-center"
    >
      {{ tipo }} tu perfil de profesor
    </h3>

    <form
      [formGroup]="teacherForm"
      (ngSubmit)="obtenerDatosFormulario()"
      class="mt-4"
    >
      <div class="row">
        <div class="mx-auto my-2 fw-light col-md-6 text-center">
          <label
            class="form-label"
            for="foto"
            title="Modifica tu imagen de perfil"
            >Foto
            <img
              [src]="profileImgUrl"
              alt="Imagen de perfil"
              class="form__img__profile img-fluid rounded-circle"
            />
          </label>
          <input
            class="form-control visually-hidden"
            type="file"
            id="foto"
            accept="image/png, image/jpeg, image/webp"
            (change)="obtenerImagen($event)"
            #fileInput
          />
          @if(checkControl('foto', 'formatoInvalido')) {
          <p class="text-danger">
            El archivo debe ser una imagen en formato JPG, PNG o WEBP
          </p>
          }
        </div>
      </div>
      <div class="row">
        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="nombre">Nombre</label>
          <input
            class="form-control"
            type="text"
            id="nombre"
            formControlName="nombre"
            placeholder="Introduce el nombre"
          />
          <div class="error-box">
            @if(checkControl('nombre', 'required')) {
            <p class="text-danger">El nombre es obligatorio</p>
            } @else if(checkControl('nombre', 'maxlength')) {
            <p class="text-danger">El nombre no debe exceder 45 caracteres</p>
            }
          </div>
        </div>

        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="apellidos">Apellidos</label>
          <input
            class="form-control"
            type="text"
            id="apellidos"
            formControlName="apellidos"
            placeholder="Introduce los apellidos"
          />
          <div class="error-box">
            @if(checkControl('apellidos', 'required')) {
            <p class="text-danger">Los apellidos son obligatorios</p>
            } @else if(checkControl('apellidos', 'maxlength')) {
            <p class="text-danger">
              Los apellidos no deben exceder 150 caracteres
            </p>
            }
          </div>
        </div>
      </div>

      <div class="row">
        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="email">Email</label>
          <input
            class="form-control"
            type="email"
            id="email"
            formControlName="email"
            placeholder="Introduce el email"
          />
          <div class="error-box">
            @if(checkControl('email', 'required')) {
            <p class="text-danger">El email es obligatorio</p>
            } @else if(checkControl('email', 'email')) {
            <p class="text-danger">Formato de email inválido</p>
            } @else if(checkControl('email', 'maxlength')) {
            <p class="text-danger">El email no debe exceder 60 caracteres</p>
            }
          </div>
        </div>

        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="telefono">Teléfono</label>
          <input
            class="form-control"
            type="text"
            id="telefono"
            formControlName="telefono"
            placeholder="Introduce el teléfono"
          />
          <div class="error-box">
            @if(checkControl('telefono', 'required')) {
            <p class="text-danger">El teléfono es obligatorio</p>
            } @else if(checkControl('telefono', 'pattern')) {
            <p class="text-danger">El teléfono debe tener 9 dígitos</p>
            }
          </div>
        </div>
      </div>

      <div class="row">
        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="password">Contraseña</label>
          <input
            class="form-control"
            type="password"
            id="password"
            formControlName="password"
            placeholder="Introduce la contraseña"
          />
          <div class="error-box">
            @if(checkControl('password', 'required')) {
            <p class="text-danger">La contraseña es obligatoria</p>
            } @else if(checkControl('password', 'minlength')) {
            <p class="text-danger">Debe tener al menos 8 caracteres</p>
            } @else if(checkControl('password', 'maxlength')) {
            <p class="text-danger">No debe exceder de 255 caracteres</p>
            } @else if(checkControl('password', 'pattern')) {
            <p class="text-danger">Debe incluir una mayúscula y un número</p>
            }
          </div>
        </div>
        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="repitepassword"
            >Repite Contraseña</label
          >
          <input
            class="form-control"
            type="password"
            id="repitepassword"
            formControlName="repitepassword"
            placeholder="Repite la contraseña"
          />
          <div class="error-box">
            @if(checkControl('repitepassword', 'required')) {
            <p class="text-danger">Debe repetir la contraseña</p>
            } @else if(teacherForm.hasError('checkpassword')) {
            <p class="text-danger">Las contraseñas no coinciden</p>
            }
          </div>
        </div>
      </div>

      <div class="row">
        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="precio_hora">Precio por Hora</label>
          <input
            class="form-control"
            type="number"
            min="0"
            id="precio_hora"
            formControlName="precio_hora"
            placeholder="Introduce el precio por hora"
          />
          <div class="error-box">
            @if(checkControl('precio_hora', 'required')) {
            <p class="text-danger">El precio por hora es obligatorio</p>
            } @else if(checkControl('precio_hora', 'min')) {
            <p class="text-danger">El precio por hora debe ser al menos 0</p>
            } @else if(checkControl('precio_hora', 'max')) {
            <p class="text-danger">El precio por hora no debe exceder 99.99</p>
            }
          </div>
        </div>
        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="meses_experiencia"
            >Meses de Experiencia</label
          >
          <input
            class="form-control"
            type="number"
            min="0"
            id="meses_experiencia"
            formControlName="meses_experiencia"
            placeholder="Introduce los meses de experiencia"
          />
          <div class="error-box">
            @if(checkControl('meses_experiencia', 'required')) {
            <p class="text-danger">Este campo es obligatorio</p>
            } @else if(checkControl('meses_experiencia', 'min')) {
            <p class="text-danger">Debe ser un valor mayor o igual a 0</p>
            }
          </div>
        </div>
      </div>

      <div class="form__last__row row">
        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="localizacion">Direccion</label>
          <input
            class="form-control"
            type="text"
            id="localizacion"
            formControlName="localizacion"
            placeholder="Introduce tu Direccion"
            #txtQuery
            (input)="queryChanged(txtQuery.value)"
          />
          <ul class="list-group" *ngIf="places.length > 0 && !isLoadingPlaces">
            <li
              *ngFor="let place of places"
              class="list-group-item list-group-item-action pointer"
              [value]="place.geometry.coordinates"
              (click)="selectPlace(place)"
            >
              <h6>{{ place.properties.full_address }}</h6>
            </li>
          </ul>
          @if(checkControl('localizacion', 'required')) {
          <small class="text-danger">La direccion es obligatoria</small>
          }
        </div>

        <div class="my-2 fw-light col-md-6">
          <label class="form-label" for="materias">Materias</label>
          <button
            type="button"
            class="btn button-secondary w-100"
            (click)="alternarDesplegable()"
          >
            Selecciona hasta 3 materias
          </button>
          @if(desplegableAbierto) {
          <div
            class="border p-2 mt-2"
            style="max-height: 150px; overflow-y: auto"
          >
            @for (materia of materiasList; track $index) {
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                [value]="materia.id"
                (change)="cambiarMateria($event)"
                [checked]="teacherForm.value.materias.includes(materia.id)"
              />
              <label class="form-check-label">{{ materia.nombre }}</label>
            </div>
            }
          </div>
          }
          <div class="error-box">
            @if(limiteMateriasExcedido) {
            <p class="text-danger">Solo puedes seleccionar hasta 3 materias</p>
            } @if(checkControl('materias', 'required')) {
            <p class="text-danger">Debe seleccionar al menos una materia</p>
            }
          </div>
        </div>
      </div>

      <div class="mt-4 mb-5 text-center">
        <input
          type="submit"
          [value]="tipo"
          class="button-primary pointer"
          [disabled]="!teacherForm.valid || errorForm.length > 0"
        />
      </div>
    </form>

    <div class="mt-4">
      @for(error of errorForm; track $index) { @if(error.message) {
      <p class="text-danger">{{ error.field }}: {{ error.message }}</p>
      } }
    </div>
  </div>
</section>
